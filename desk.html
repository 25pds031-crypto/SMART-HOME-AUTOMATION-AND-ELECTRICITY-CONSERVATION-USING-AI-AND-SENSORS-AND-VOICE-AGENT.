<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Energy Management System</title>

<style>
body {
  margin: 0;
  background-color: #020617;
  color: #e5e7eb;
  font-family: Arial, Helvetica, sans-serif;
}

/* ---------- LOGIN ---------- */
#loginContainer {
  width: 100%;
  height: 100vh;
  padding-top: 120px;
  text-align: center;
}

#loginBox {
  width: 320px;
  margin: auto;
  background-color: #0f172a;
  padding: 25px;
  border-radius: 10px;
}

input {
  width: 90%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 5px;
  border: none;
}

button {
  margin-top: 15px;
  padding: 10px;
  width: 95%;
  border-radius: 5px;
  border: none;
  background-color: #38bdf8;
  font-weight: bold;
  cursor: pointer;
}

/* ---------- DASHBOARD ---------- */
#dashboard {
  display: none;
}

header {
  background-color: #020617;
  padding: 10px;
  border-bottom: 1px solid #1e293b;
}

header span {
  font-size: 18px;
  font-weight: bold;
}

header button {
  float: right;
  width: auto;
  padding: 6px 12px;
}

.section {
  background-color: #0f172a;
  margin: 15px;
  padding: 15px;
  border-radius: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

th, td {
  border-bottom: 1px solid #1e293b;
  padding: 6px;
  text-align: center;
}

.on {
  background-color: #22c55e;
  color: #000;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
}

.off {
  background-color: #ef4444;
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
}

canvas {
  background-color: #020617;
  display: block;
  margin: auto;
  border-radius: 6px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginContainer">
  <div id="loginBox">
    <h2>EMS Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button type="button" onclick="login()">Login</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">

<header>
  <span>⚡ Energy Management System</span>
  <button type="button" onclick="logout()">Logout</button>
  <div style="clear:both"></div>
</header>

<div class="section">
  <b>Total Power:</b> <span id="totalPower">0</span> W &nbsp; | &nbsp;
  <b>Total Energy:</b> <span id="totalEnergy">0</span> kWh &nbsp; | &nbsp;
  <b>Total Cost (₹):</b> <span id="totalCost">0</span>
</div>

<div class="section">
  <canvas id="chart" width="800" height="200"></canvas>
</div>

<div class="section">
<table>
<thead>
<tr>
<th>Device</th>
<th>Power (W)</th>
<th>Energy (kWh)</th>
<th>Cost (₹)</th>
<th>Relay</th>
</tr>
</thead>
<tbody id="deviceRows"></tbody>
</table>
</div>

</div>

<script>
/* ---------- GLOBAL SAFE VARIABLES ---------- */
var RATE = 6;
var deviceCount = 15;
var devices = [];
var timer = null;
var chartPoints = [];

/* ---------- LOGIN ---------- */
function login() {
  var u = document.getElementById("username").value;
  var p = document.getElementById("password").value;

  if (u === "admin" && p === "admin") {
    document.getElementById("loginContainer").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
    initializeSystem();
  } else {
    alert("Invalid login. Use admin / admin");
  }
}

function logout() {
  if (timer) clearInterval(timer);
  location.reload();
}

/* ---------- INITIALIZE ---------- */
function initializeSystem() {
  var tbody = document.getElementById("deviceRows");
  tbody.innerHTML = "";

  for (var i = 0; i < deviceCount; i++) {
    devices.push({
      name: "Device-" + (i + 1),
      power: 0,
      energy: 0,
      relay: true
    });

    tbody.innerHTML +=
      "<tr>" +
      "<td>" + devices[i].name + "</td>" +
      "<td id='p" + i + "'>0</td>" +
      "<td id='e" + i + "'>0</td>" +
      "<td id='c" + i + "'>0</td>" +
      "<td><span id='r" + i + "' class='on' onclick='toggleRelay(" + i + ")'>ON</span></td>" +
      "</tr>";
  }

  startLiveData();
}

/* ---------- RELAY ---------- */
function toggleRelay(index) {
  devices[index].relay = !devices[index].relay;
  var r = document.getElementById("r" + index);
  if (devices[index].relay) {
    r.className = "on";
    r.innerHTML = "ON";
  } else {
    r.className = "off";
    r.innerHTML = "OFF";
  }
}

/* ---------- LIVE DATA ---------- */
function startLiveData() {
  timer = setInterval(updateData, 1000);
}

function updateData() {
  var totalP = 0;
  var totalE = 0;

  for (var i = 0; i < devices.length; i++) {
    if (devices[i].relay) {
      devices[i].power = Math.floor(Math.random() * 400);
      devices[i].energy += devices[i].power / 1000 / 3600;
    } else {
      devices[i].power = 0;
    }

    totalP += devices[i].power;
    totalE += devices[i].energy;

    document.getElementById("p" + i).innerHTML = devices[i].power;
    document.getElementById("e" + i).innerHTML = devices[i].energy.toFixed(4);
    document.getElementById("c" + i).innerHTML = (devices[i].energy * RATE).toFixed(2);
  }

  document.getElementById("totalPower").innerHTML = totalP;
  document.getElementById("totalEnergy").innerHTML = totalE.toFixed(4);
  document.getElementById("totalCost").innerHTML = (totalE * RATE).toFixed(2);

  drawChart(totalP);
}

/* ---------- CHART ---------- */
function drawChart(value) {
  var canvas = document.getElementById("chart");
  var ctx = canvas.getContext("2d");

  chartPoints.push(value);
  if (chartPoints.length > 60) chartPoints.shift();

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  ctx.strokeStyle = "#38bdf8";

  for (var i = 0; i < chartPoints.length; i++) {
    var x = (i / 60) * canvas.width;
    var y = canvas.height - (chartPoints[i] / 10);
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();
}
</script>

</body>
</html>